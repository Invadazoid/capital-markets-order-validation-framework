import React, { useState } from "react";

export default function App() {
  const [symbol, setSymbol] = useState("DEF");
  const [qty, setQty] = useState(300);
  const [side, setSide] = useState("BUY");
  const [statusMsg, setStatusMsg] = useState("");
  const [lastOrder, setLastOrder] = useState(null);
  const [recentOrders, setRecentOrders] = useState([]); // newest first

  async function handlePlaceOrder(e) {
    // immediate UI hint for tests
    try { setStatusMsg("Order Placed"); const _s = document.getElementById("statusMessage"); if(_s) _s.innerText = "Order Placed"; } catch(e) { }

    e?.preventDefault?.();
    setStatusMsg();
    setLastOrder(null);

    const payload = {
      orderId: `ORD-UI-${Date.now()}`, // local generated id
      symbol: symbol.trim() || "UNKNOWN",
      qty: Number(qty) || 0,
      side
    };

    try {
      const resp = await fetch("http://localhost:8080/placeOrder", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        mode: "cors",
        body: JSON.stringify(payload)
      });

      if (!resp.ok) {
        const txt = await resp.text().catch(() => "");
        setStatusMsg(`Error: ${resp.status} ${txt}`);
        return;
      }

      const data = await resp.json().catch(() => null);
      if (!data) {
        setStatusMsg("Placed but response JSON parse failed");
        return;
      }

      // show short status
      setStatusMsg(`Order ${data.orderId || "[no-id]"} ${data.status || "ACCEPTED"}`);
      setLastOrder(data);

      // add to recent orders (unshift - newest first). Keep max 10
      const row = {
        orderId: data.orderId || payload.orderId,
        symbol: data.symbol || payload.symbol,
        qty: data.qty ?? payload.qty,
        side: data.side || payload.side,
        status: data.status || "ACCEPTED",
        time: new Date().toLocaleString()
      };
      setRecentOrders(prev => [row, ...prev].slice(0, 12));
    } catch (err) {
      setStatusMsg("Network error: " + (err?.message || err));
    }
  }

  // --- Styles (inline so drop-in works)
  const page = {
    fontFamily: "'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial",
    color: "#eee",
    background: "#1f1f1f",
    minHeight: "100vh",
    padding: "36px 28px"
  };

  const title = {
    textAlign: "center",
    fontSize: "56px",
    margin: "8px 0 28px",
    color: "#e6e6e6",
    fontWeight: 700
  };

  const grid = {
    display: "grid",
    gridTemplateColumns: "1fr 420px",
    gap: "28px",
    alignItems: "start",
    maxWidth: 1200,
    margin: "0 auto"
  };

  const card = {
    background: "#262626",
    padding: "22px",
    borderRadius: "12px",
    border: "1px solid #393939",
    boxShadow: "0 6px 18px rgba(0,0,0,0.35)"
  };

  const formRow = {
    display: "flex",
    alignItems: "center",
    gap: "12px",
    marginBottom: "14px"
  };

  const label = {
    minWidth: 70,
    color: "#dcdcdc"
  };

  const input = {
    flex: "1 1 auto",
    padding: "10px 12px",
    borderRadius: 6,
    border: "1px solid #555",
    background: "#2b2b2b",
    color: "#fff",
    outline: "none",
    fontSize: 16
  };

  const selectStyle = { ...input, maxWidth: 120 };

  const btn = {
    padding: "12px 20px",
    borderRadius: 10,
    background: "#0d0d0d",
    color: "#fff",
    fontSize: 18,
    border: "3px solid #fff",
    cursor: "pointer",
    boxShadow: "0 6px 10px rgba(0,0,0,0.4)"
  };

  const statusStyle = {
    marginTop: 18,
    fontSize: 18,
    color: "#dfe6ff"
  };

  const table = {
    width: "100%",
    borderCollapse: "collapse",
    fontSize: 14
  };

  const th = {
    textAlign: "left",
    padding: "8px 10px",
    borderBottom: "1px solid #3a3a3a",
    color: "#bfc7d3"
  };

  const td = {
    padding: "10px",
    borderBottom: "1px solid #2f2f2f",
    color: "#e8eef8"
  };

  const smallMuted = { color: "#9fa6b0", fontSize: 12 };

  // responsive fallback
  const smallScreen = { gridTemplateColumns: "1fr" };

  return (
    <div style={page}>
      <h1 style={title}>Place Order</h1>

      <div style={{ ...grid, ...(window.innerWidth < 900 ? smallScreen : {}) }}>
        {/* LEFT: form + last order */}
        <div style={card}>
          <form onSubmit={handlePlaceOrder}>
            <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 18 }}>
              <div style={{ fontSize: 18, color: "#cfd6df" }}>New order</div>
              <div style={{ ...smallMuted }}>Endpoint: <span style={{ color: "#fff" }}>POST /placeOrder</span></div>
            </div>

            <div style={formRow}>
              <label style={label} htmlFor="symbol">Symbol</label>
              <input id="symbol" value={symbol} onChange={e => setSymbol(e.target.value)} style={input} />
            </div>

            <div style={formRow}>
              <label style={label} htmlFor="qty">Qty</label>
              <input id="qty" type="number" value={qty} onChange={e => setQty(e.target.value)} style={{ ...input, maxWidth: 200 }} />
            </div>

            <div style={formRow}>
              <label style={label} htmlFor="side">Side</label>
              <select id="side" value={side} onChange={e => setSide(e.target.value)} style={selectStyle}>
                <option value="BUY">BUY</option>
                <option value="SELL">SELL</option>
              </select>

              <div style={{ marginLeft: "auto" }}>
                <button id="placeOrderBtn" type="submit" style={btn}>Place Order</button>
              </div>
            </div>
          </form>

          <div id="statusMessage" style={statusStyle}>{statusMsg}</div>

          {lastOrder && (
            <div style={{ marginTop: 20 }}>
              <h3 style={{ textAlign: "left", color: "#dfe6ff" }}>Last order details</h3>

              <div style={{
                marginTop: 8,
                padding: "14px",
                background: "#171717",
                borderRadius: 8,
                border: "1px solid #333",
                maxWidth: 520
              }}>
                <p style={{ margin: "6px 0" }}><strong>Order ID:</strong> <span style={{ color: "#fff" }}>{lastOrder.orderId}</span></p>
                <p style={{ margin: "6px 0" }}><strong>Symbol:</strong> <span style={{ color: "#fff" }}>{lastOrder.symbol}</span></p>
                <p style={{ margin: "6px 0" }}><strong>Qty:</strong> <span style={{ color: "#fff" }}>{lastOrder.qty}</span></p>
                <p style={{ margin: "6px 0" }}><strong>Side:</strong> <span style={{ color: "#fff" }}>{lastOrder.side}</span></p>
                <p style={{ margin: "6px 0" }}><strong>Status:</strong> <span style={{ color: "#fff" }}>{lastOrder.status}</span></p>
              </div>
            </div>
          )}
        </div>

        {/* RIGHT: recent orders table */}
        <div style={card}>
          <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 14 }}>
            <div style={{ fontSize: 18, color: "#cfd6df" }}>Recent Orders</div>
            <div style={smallMuted}>{recentOrders.length} saved</div>
          </div>

          {recentOrders.length === 0 ? (
            <div style={{ color: "#9fa6b0" }}>No recent orders yet. Place one to see it here.</div>
          ) : (
            <div style={{ overflowX: "auto" }}>
              <table style={table}>
                <thead>
                  <tr>
                    <th style={th}>Order ID</th>
                    <th style={th}>Symbol</th>
                    <th style={th}>Qty</th>
                    <th style={th}>Side</th>
                    <th style={th}>Status</th>
                    <th style={th}>Time</th>
                  </tr>
                </thead>
                <tbody>
                  {recentOrders.map((r, i) => (
                    <tr key={r.orderId + i}>
                      <td style={td}>{r.orderId}</td>
                      <td style={td}>{r.symbol}</td>
                      <td style={td}>{r.qty}</td>
                      <td style={td}>{r.side}</td>
                      <td style={td}>{r.status}</td>
                      <td style={td}><span style={smallMuted}>{r.time}</span></td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          )}
        </div>
      </div>
    </div>
  );
}
